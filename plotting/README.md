# Plotting - Result Analysis

These scripts are responsible for evaluating the benchmark data. The results will either be shown in the terminal or the plots will be stored in the `~/dbms-live-patching/plot/reproduction` directory. Please see the README of the [plots](../plots) directory for the file mapping, which file corresponds to which figure in the paper.

## Linux Kernel

The following steps should be executed using the ***unmodified*** Linux kernel.

```
cd ~
./kernel-regular
sudo reboot
```

## Plot Directory

All plots will be stored in `~/dbms-live-patching/plots/reproduction`. The directory `~/dbms-live-patching/plots/paper` contains all plots from the paper, including additional ones referenced or mentioned therein. Please see the README of the [plots](../plots) directory for the file mapping, which file corresponds to which figure in the paper.

## All Plots (Figure 1 and 5 - 10)

All *plots* can be generated by using a single script. However, the analysis for the latency breakdown and for table 2 must still be executed (see commands below).

```
cd ~/dbms-live-patching/plotting/plot
./setup
./do-all
```



## MariaDB - Teaser (Figure 1)

```
cd ~/dbms-live-patching/plotting/plot

./setup

./do-one-by-one
```

## MariaDB - OLTP Benchmarks (Figure 5)

```
cd ~/dbms-live-patching/plotting/plot

# Setup was already performed
# ./setup

./do-qps-time
```

### Additional - Bar Charts

```
./do-qps-bar
```



## MariaDB - OLAP Benchmarks (Figure 6)

```
cd ~/dbms-live-patching/plotting/plot

# Setup was already performed
# ./setup

./do-OTPC-ch-time
```

## MariaDB - Synchronization Time (Figure 7)

```
cd ~/dbms-live-patching/plotting/plot

# Setup was already performed
# ./setup

./do-TP-every-boxplot
```

## MariaDB - Latencies (Figure 8)

```
cd ~/dbms-live-patching/plotting/plot

# Setup was already performed
# ./setup

./do-OTPC-latencies
```

### Additional - Thread Pool Latencies

```
./do-TP-latencies
```

## Redis - Impact of database state on maximum query latency (Figure 9)

```
cd ~/dbms-live-patching/plotting/plot

# Setup was already performed
# ./setup

./do-redis-as-fork
```

## MariaDB/Redis - Impact of patch size on patch application time (Figure 10)

```
cd ~/dbms-live-patching/plotting/plot

# Setup was already performed
# ./setup

./do-patch-application
```

## Latency Breakdown (Table 2)

The results will be shown in the terminal.

```
cd ~/dbms-live-patching/plotting/latency-breakdown
./new-as
./patch-application
./reach-q
./switch-as
```

## MariaDB - Thread Pool comparison: Priority-based quiescence (our novel approach) vs previous (Rommel et al. [2]) approach

The results will be shown in the terminal.

```
cd ~/dbms-live-patching/plotting/comparison
./evaluate-comparison
```

The version `wfpatch.patch-18502f99eb24f37d11e2431a89fd041cbdaea621` is our implementation, while `mariadb-wf-10.3.15` is the version of Rommel et al. [2]. 

Example output:

```
/home/repro/dbms-live-patching/plotting/comparison/../../data/threadpool-comparison/result-ycsb/wfpatch.patch-18502f99eb24f37d11e2431a89fd041cbdaea621-ycsb
Total Experiments: 100
Total 'Deadlocks': 0
Total #Recorded Latencies: 164335571
Maximum #Recorded Latencies: 1685122
Total Patchings during all Experiments: 2900
```

- The path contains the respective version.
- Lines `Total #Recorded Latencies` and `Maximum #Recorded Latencies` can be ignored.
- `Total 'Deadlocks':` should be `0` and `Total Patchings during all Experiments:` should be `2900`. This means that no deadlock occurred, and all patches were successfully applied. When `Total 'Deadlocks'` shows a value of `100`, this means that every patch request caused a deadlock.

[2] Florian Rommel, Christian Dietrich, Daniel Friesel, Marcel Köppen, ChristophBorchert, Michael Müller, Olaf Spinczyk, and Daniel Lohmann. 2020. *From Global to Local Quiescence: Wait-Free Code Patching of Multi-Threaded Processes*. In Proc. OSDI. 651–666.

## Original Data

To analyze our benchmark data, you can perform the following steps:

```
cd ~/dbms-live-patching
# Download data
./download-transformed-data

# Change base directory storing all data:
vim plotting/plot/INPUT_BASE_DIRECTORY

# Change directory to transformed-data directory:
#export INPUT_BASE_DIRECTORY=${SCRIPT_DIR}/../../data
export INPUT_BASE_DIRECTORY=${SCRIPT_DIR}/../../transformed-data
```

---

## arXiv Plots

Scripts prefixed with `arxiv-` are dedicated to generating plots for the arXiv version of the paper. These plots are larger and display all patch IDs for enhanced readability.
